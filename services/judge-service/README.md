# è¯„æµ‹æœåŠ¡ (Judge Service)

## ğŸ“ æœåŠ¡ç®€ä»‹

è¯„æµ‹æœåŠ¡è´Ÿè´£å¤„ç†ä»£ç æäº¤ã€ç¼–è¯‘æ‰§è¡Œã€ç»“æœåˆ¤å®šç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œæ˜¯åœ¨çº¿ç¼–ç¨‹å®è®­å¹³å°çš„æ ¸å¿ƒæœåŠ¡ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### å·²å®ç°åŠŸèƒ½

- âœ… **ä»£ç æäº¤**: æ”¯æŒJavaã€Cã€C++ã€Pythonå¤šè¯­è¨€ä»£ç æäº¤
- âœ… **è‡ªåŠ¨è¯„æµ‹**: æ¨¡æ‹Ÿè¯„æµ‹å¼•æ“ï¼Œéšæœºç”Ÿæˆè¯„æµ‹ç»“æœï¼ˆç”¨äºæ¼”ç¤ºï¼‰
- âœ… **æäº¤è®°å½•**: å®Œæ•´çš„æäº¤å†å²è®°å½•æŸ¥è¯¢
- âœ… **è¯„æµ‹ç»“æœ**: è¯¦ç»†çš„è¯„æµ‹ç»“æœå±•ç¤ºï¼ˆçŠ¶æ€ã€å¾—åˆ†ã€è¿è¡Œæ—¶é—´ã€å†…å­˜ä½¿ç”¨ï¼‰
- âœ… **é‡æ–°è¯„æµ‹**: æ”¯æŒå¯¹å·²æäº¤ä»£ç é‡æ–°è¯„æµ‹
- âœ… **åˆ†é¡µæŸ¥è¯¢**: æŒ‰ç”¨æˆ·ã€æŒ‰é¢˜ç›®æŸ¥è¯¢æäº¤è®°å½•

### å¾…å®ç°åŠŸèƒ½

- â³ **Dockeræ²™ç®±**: åŸºäºDockerçš„ä»£ç å®‰å…¨æ‰§è¡Œç¯å¢ƒ
- â³ **çœŸå®ç¼–è¯‘**: å®é™…ç¼–è¯‘C/C++/Javaä»£ç 
- â³ **æµ‹è¯•ç”¨ä¾‹å¯¹æ¯”**: å°†è¾“å‡ºä¸é¢„æœŸç»“æœå¯¹æ¯”
- â³ **èµ„æºé™åˆ¶**: CPUæ—¶é—´ã€å†…å­˜é™åˆ¶
- â³ **å¼‚æ­¥é˜Ÿåˆ—**: ä½¿ç”¨RabbitMQå¼‚æ­¥å¤„ç†è¯„æµ‹ä»»åŠ¡ï¼ˆéœ€å®‰è£…RabbitMQï¼‰
- â³ **å®æ—¶æ¨é€**: WebSocketå®æ—¶æ¨é€è¯„æµ‹è¿›åº¦
- â³ **Redisç¼“å­˜**: ç¼“å­˜é¢˜ç›®ä¿¡æ¯ã€è¯„æµ‹ç»“æœï¼ˆéœ€å®‰è£…Redisï¼‰

### ğŸ”§ å½“å‰è¿è¡Œè¦æ±‚

**å¿…éœ€ç»„ä»¶**ï¼š
- âœ… MySQL 8.0+ï¼ˆæ•°æ®å­˜å‚¨ï¼‰
- âœ… Nacos 2.2.0+ï¼ˆæœåŠ¡æ³¨å†Œï¼‰
- âœ… JDK 17+ï¼ˆè¿è¡Œç¯å¢ƒï¼‰

**å¯é€‰ç»„ä»¶ï¼ˆå·²ç¦ç”¨ï¼‰**ï¼š
- âš ï¸ Redisï¼ˆç¼“å­˜ã€Sessionï¼‰- å½“å‰æœªä½¿ç”¨ï¼Œå·²åœ¨é…ç½®ä¸­ç¦ç”¨
- âš ï¸ RabbitMQï¼ˆå¼‚æ­¥é˜Ÿåˆ—ï¼‰- å½“å‰æœªä½¿ç”¨ï¼Œå·²åœ¨é…ç½®ä¸­ç¦ç”¨
- âš ï¸ Dockerï¼ˆä»£ç æ²™ç®±ï¼‰- æœªæ¥å®ç°çœŸå®è¯„æµ‹æ—¶éœ€è¦

> ğŸ’¡ **è¯´æ˜**ï¼šå½“å‰ç‰ˆæœ¬ä½¿ç”¨åŒæ­¥è¯„æµ‹æ¨¡å¼ï¼Œä¸éœ€è¦Rediså’ŒRabbitMQå³å¯è¿è¡Œã€‚
> å¦‚éœ€å¯ç”¨å¼‚æ­¥è¯„æµ‹å’Œç¼“å­˜ï¼Œè¯·å‚è€ƒ `ä¸­é—´ä»¶è¯´æ˜å’Œå®‰è£…æŒ‡å—.md`

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### submissionï¼ˆæäº¤è®°å½•è¡¨ï¼‰
- `id`: æäº¤ID
- `problem_id`: é¢˜ç›®ID
- `user_id`: ç”¨æˆ·ID
- `language`: ç¼–ç¨‹è¯­è¨€
- `code`: æäº¤ä»£ç 
- `status`: è¯„æµ‹çŠ¶æ€
- `score`: å¾—åˆ†
- `time_used`: è¿è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
- `memory_used`: å†…å­˜ä½¿ç”¨ï¼ˆKBï¼‰
- `error_message`: é”™è¯¯ä¿¡æ¯
- `pass_rate`: é€šè¿‡ç‡
- `created_time`: æäº¤æ—¶é—´
- `judged_time`: åˆ¤é¢˜å®Œæˆæ—¶é—´

### judge_queueï¼ˆè¯„æµ‹é˜Ÿåˆ—è¡¨ï¼‰
å¾…å®ç°å¼‚æ­¥è¯„æµ‹æ—¶ä½¿ç”¨

### judge_detailï¼ˆåˆ¤é¢˜ç»“æœè¯¦æƒ…è¡¨ï¼‰
å¾…å®ç°æµ‹è¯•ç”¨ä¾‹è¯¦æƒ…æ—¶ä½¿ç”¨

## ğŸ”Œ APIæ¥å£

### 1. å¥åº·æ£€æŸ¥
```http
GET /judge/health
```

### 2. æäº¤ä»£ç 
```http
POST /judge/submit
Content-Type: application/json

{
  "problemId": 1,
  "userId": 3,
  "language": "JAVA",
  "code": "public class Solution {...}"
}
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "success",
  "data": 1  // submissionId
}
```

### 3. æŸ¥è¯¢æäº¤è®°å½•è¯¦æƒ…
```http
GET /judge/submission/{id}
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "problemId": 1,
    "userId": 3,
    "language": "JAVA",
    "code": "...",
    "status": "ACCEPTED",
    "statusDesc": "é€šè¿‡",
    "score": 100,
    "timeUsed": 125,
    "memoryUsed": 8192,
    "passRate": 100.00,
    "createTime": "2025-12-05T14:00:00",
    "judgedTime": "2025-12-05T14:00:01"
  }
}
```

### 4. æŸ¥è¯¢è¯„æµ‹ç»“æœ
```http
GET /judge/result/{submissionId}
```

### 5. æŸ¥è¯¢ç”¨æˆ·æäº¤è®°å½•
```http
GET /judge/submissions/user/{userId}?page=1&size=10
```

### 6. æŸ¥è¯¢é¢˜ç›®æäº¤è®°å½•
```http
GET /judge/submissions/problem/{problemId}?page=1&size=10
```

### 7. é‡æ–°è¯„æµ‹
```http
POST /judge/rejudge/{submissionId}
```

## ğŸ“ è¯„æµ‹çŠ¶æ€è¯´æ˜

| çŠ¶æ€ç  | çŠ¶æ€åç§° | è¯´æ˜ |
|--------|---------|------|
| PENDING | ç­‰å¾…è¯„æµ‹ | ä»£ç å·²æäº¤ï¼Œç­‰å¾…è¯„æµ‹ |
| JUDGING | è¯„æµ‹ä¸­ | æ­£åœ¨æ‰§è¡Œè¯„æµ‹ |
| ACCEPTED | é€šè¿‡ | ä»£ç é€šè¿‡æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ |
| WRONG_ANSWER | ç­”æ¡ˆé”™è¯¯ | éƒ¨åˆ†æµ‹è¯•ç”¨ä¾‹æœªé€šè¿‡ |
| TIME_LIMIT_EXCEEDED | æ—¶é—´è¶…é™ | æ‰§è¡Œæ—¶é—´è¶…è¿‡é™åˆ¶ |
| MEMORY_LIMIT_EXCEEDED | å†…å­˜è¶…é™ | å†…å­˜ä½¿ç”¨è¶…è¿‡é™åˆ¶ |
| RUNTIME_ERROR | è¿è¡Œæ—¶é”™è¯¯ | ç¨‹åºè¿è¡Œæ—¶å‡ºé”™ |
| COMPILE_ERROR | ç¼–è¯‘é”™è¯¯ | ä»£ç ç¼–è¯‘å¤±è´¥ |
| SYSTEM_ERROR | ç³»ç»Ÿé”™è¯¯ | è¯„æµ‹ç³»ç»Ÿé”™è¯¯ |

## ğŸ› ï¸ é…ç½®è¯´æ˜

### application.yml
```yaml
server:
  port: 8083

spring:
  application:
    name: judge-service
  
  # ç¦ç”¨æš‚æ—¶ä¸éœ€è¦çš„è‡ªåŠ¨é…ç½®
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
      - org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration
  
  datasource:
    url: jdbc:mysql://localhost:3306/cloud_oj_judge
    username: cloud_oj
    password: cloud_oj_2025
  
  # Rediså’ŒRabbitMQå·²ç¦ç”¨ï¼ˆéœ€è¦æ—¶å–æ¶ˆæ³¨é‡Šï¼‰
  # data:
  #   redis:
  #     host: localhost
  #     port: 6379

# MyBatisé…ç½®ï¼ˆä½¿ç”¨XMLæ˜ å°„æ–‡ä»¶æ–¹å¼ï¼‰
mybatis:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  mapper-locations: classpath:mapper/**/*.xml
  type-aliases-package: com.cloudoj.model.entity

# Dockeré…ç½®ï¼ˆå¾…å®ç°ï¼‰
docker:
  host: tcp://localhost:2375
```

### ä¸­é—´ä»¶ä¾èµ–

| ç»„ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| MySQL | âœ… å¿…éœ€ | æ•°æ®æŒä¹…åŒ– |
| Nacos | âœ… å¿…éœ€ | æœåŠ¡æ³¨å†Œ |
| Redis | âš ï¸ å·²ç¦ç”¨ | æœªæ¥ç”¨äºç¼“å­˜ |
| RabbitMQ | âš ï¸ å·²ç¦ç”¨ | æœªæ¥ç”¨äºå¼‚æ­¥é˜Ÿåˆ— |

> ğŸ’¡ å¦‚éœ€å¯ç”¨Rediså’ŒRabbitMQï¼Œè¯·å‚è€ƒé¡¹ç›®æ ¹ç›®å½•çš„ `ä¸­é—´ä»¶è¯´æ˜å’Œå®‰è£…æŒ‡å—.md`

### Mapperå®ç°æ–¹å¼
æœ¬æœåŠ¡ä½¿ç”¨ **åŸç”ŸMyBatis + XMLæ˜ å°„æ–‡ä»¶** æ–¹å¼ï¼Œä¸ç”¨æˆ·æœåŠ¡ã€é¢˜åº“æœåŠ¡ä¿æŒä¸€è‡´ï¼š
- Mapperæ¥å£ï¼š`com.cloudoj.judge.mapper.SubmissionMapper`
- XMLæ˜ å°„æ–‡ä»¶ï¼š`resources/mapper/SubmissionMapper.xml`
- ä¸ä½¿ç”¨MyBatis Pluså’Œæ³¨è§£æ–¹å¼

## ğŸ§ª æµ‹è¯•æŒ‡å—

### 1. å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨Nacosã€MySQLã€Redis
# å¯åŠ¨ç½‘å…³æœåŠ¡
# å¯åŠ¨è¯„æµ‹æœåŠ¡
```

### 2. æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–
```bash
mysql -u cloud_oj -pcloud_oj_2025 cloud_oj_judge < sql/4_judge_service.sql
```

### 3. ä½¿ç”¨HTTPæ–‡ä»¶æµ‹è¯•
åœ¨IDEAä¸­æ‰“å¼€ `æµ‹è¯•è¯„æµ‹æœåŠ¡API.http`ï¼Œé€ä¸ªæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚

### 4. éªŒè¯åŠŸèƒ½
- âœ… æäº¤Javaä»£ç 
- âœ… æäº¤Pythonä»£ç   
- âœ… æŸ¥è¯¢æäº¤è®°å½•
- âœ… æŸ¥è¯¢è¯„æµ‹ç»“æœ
- âœ… é‡æ–°è¯„æµ‹

## ğŸ”§ å¼€å‘è¯´æ˜

### å½“å‰å®ç°
è¯„æµ‹æœåŠ¡ç›®å‰ä½¿ç”¨**æ¨¡æ‹Ÿè¯„æµ‹**æ–¹å¼ï¼š
- éšæœºç”Ÿæˆè¯„æµ‹ç»“æœï¼ˆ70%é€šè¿‡ã€15%ç­”æ¡ˆé”™è¯¯ã€10%è¿è¡Œæ—¶é”™è¯¯ã€5%æ—¶é—´è¶…é™ï¼‰
- æ¨¡æ‹Ÿè¿è¡Œæ—¶é—´å’Œå†…å­˜ä½¿ç”¨
- ä¸»è¦ç”¨äºæ¼”ç¤ºå’Œæµ‹è¯•å‰ç«¯äº¤äº’

### ä¸‹ä¸€æ­¥å¼€å‘
1. **å®ç°Dockeræ²™ç®±**
   - ä½¿ç”¨docker-javaå®¢æˆ·ç«¯
   - åˆ›å»ºéš”ç¦»çš„å®¹å™¨ç¯å¢ƒ
   - é™åˆ¶CPUå’Œå†…å­˜èµ„æº

2. **å®ç°çœŸå®ç¼–è¯‘æ‰§è¡Œ**
   - Java: javac + java
   - C/C++: gcc/g++
   - Python: python3

3. **æµ‹è¯•ç”¨ä¾‹å¯¹æ¯”**
   - ä»é¢˜åº“æœåŠ¡è·å–æµ‹è¯•ç”¨ä¾‹
   - æ‰§è¡Œä»£ç å¹¶æ•è·è¾“å‡º
   - å¯¹æ¯”å®é™…è¾“å‡ºå’Œé¢„æœŸè¾“å‡º

4. **å¼‚æ­¥è¯„æµ‹é˜Ÿåˆ—**
   - ä½¿ç”¨RabbitMQ
   - ç”Ÿäº§è€…ï¼šæäº¤ä»£ç æ—¶å…¥é˜Ÿ
   - æ¶ˆè´¹è€…ï¼šè¯„æµ‹å·¥ä½œçº¿ç¨‹

## ğŸ“ æ¥å£è°ƒç”¨ç¤ºä¾‹

### cURLç¤ºä¾‹
```bash
# æäº¤ä»£ç 
curl -X POST http://localhost:8083/judge/submit \
  -H "Content-Type: application/json" \
  -d '{
    "problemId": 1,
    "userId": 3,
    "language": "JAVA",
    "code": "public class Solution {...}"
  }'

# æŸ¥è¯¢ç»“æœ
curl http://localhost:8083/judge/result/1
```

### é€šè¿‡ç½‘å…³è°ƒç”¨
```bash
curl -X POST http://localhost:8080/api/judge/submit \
  -H "Content-Type: application/json" \
  -d '{...}'
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¼‚æ­¥å¤„ç†**: ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†è¯„æµ‹ä»»åŠ¡
2. **ç¼“å­˜ç»“æœ**: ç›¸åŒä»£ç çš„è¯„æµ‹ç»“æœå¯ç¼“å­˜
3. **èµ„æºæ± **: ç»´æŠ¤Dockerå®¹å™¨æ± ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯
4. **é™æµ**: é˜²æ­¢æ¶æ„æäº¤ï¼Œé™åˆ¶ç”¨æˆ·æäº¤é¢‘ç‡
5. **è´Ÿè½½å‡è¡¡**: å¤šä¸ªè¯„æµ‹æœåŠ¡å®ä¾‹ï¼Œåˆ†å¸ƒå¼è¯„æµ‹

## ğŸ” å®‰å…¨å»ºè®®

1. **ä»£ç æ£€æŸ¥**: æ£€æµ‹æ¶æ„ä»£ç ï¼ˆå¦‚forkç‚¸å¼¹ï¼‰
2. **èµ„æºé™åˆ¶**: ä¸¥æ ¼é™åˆ¶CPUã€å†…å­˜ã€ç½‘ç»œ
3. **éš”ç¦»ç¯å¢ƒ**: Dockerå®¹å™¨å®Œå…¨éš”ç¦»
4. **æƒé™æ§åˆ¶**: éªŒè¯ç”¨æˆ·èº«ä»½å’Œæƒé™
5. **æ—¥å¿—å®¡è®¡**: è®°å½•æ‰€æœ‰æäº¤å’Œè¯„æµ‹æ—¥å¿—

---

**å½“å‰ç‰ˆæœ¬**: v1.0.0ï¼ˆæ¨¡æ‹Ÿè¯„æµ‹ç‰ˆæœ¬ï¼‰  
**æœ€åæ›´æ–°**: 2025-12-05
