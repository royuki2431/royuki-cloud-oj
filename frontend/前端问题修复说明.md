# 前端问题修复说明

## 🐛 已修复的问题

### 1. 题目列表不显示 ✅

**问题原因**：
- 后端返回的字段名是 `list`
- 前端期望的字段名是 `records`

**修复方式**：
```typescript
// 修改 ProblemList.vue
problems.value = data.list || data.records || []
```

**后端返回格式**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [...],      // ← 后端使用list
    "total": 100,
    "pageNum": 1,
    "pageSize": 10
  }
}
```

### 2. 代码评测页面消失 ✅

**问题原因**：
- 路由配置中缺少 `/judge` 路由
- 导航栏中没有"代码评测"菜单项

**修复方式**：
1. 添加路由：
```typescript
{
  path: '/judge',
  name: 'Judge',
  component: () => import('@/views/JudgePage.vue'),
  meta: { title: '代码评测', requiresAuth: false },
}
```

2. 添加导航菜单：
```html
<el-menu-item index="/judge">
  <el-icon><EditPen /></el-icon>
  <span>代码评测</span>
</el-menu-item>
```

---

## 📁 修改的文件

1. **frontend/src/views/ProblemList.vue**
   - 修复数据字段映射（list → records）

2. **frontend/src/api/problem.ts**
   - 更新API返回类型定义

3. **frontend/src/router/index.ts**
   - 添加 `/judge` 路由

4. **frontend/src/App.vue**
   - 添加"代码评测"导航菜单项
   - 导入 `EditPen` 图标

---

## 🚀 测试步骤

### 1. 确认前端依赖已安装

```powershell
cd d:\dev\pyfile\royuki-cloud-oj\frontend
npm install
```

### 2. 启动前端开发服务器

```powershell
npm run dev
```

### 3. 测试题目列表

1. 访问 http://localhost:3000/problems
2. **预期结果**：
   - ✅ 显示题目列表
   - ✅ 可以看到题号、题目、难度、标签等信息
   - ✅ 分页功能正常
   - ✅ 搜索和筛选功能正常

### 4. 测试代码评测页面

1. 点击导航栏"代码评测"
2. 或直接访问 http://localhost:3000/judge
3. **预期结果**：
   - ✅ 显示代码编辑器
   - ✅ 可以选择编程语言
   - ✅ 可以输入题目ID
   - ✅ 可以提交代码

### 5. 完整功能测试流程

#### A. 从题库开始做题
1. 访问题库页面
2. 点击某个题目的"开始做题"按钮
3. 跳转到题目详情页
4. 在左侧查看题目描述
5. 在右侧编写代码
6. 提交代码并查看结果

#### B. 直接评测代码
1. 点击"代码评测"菜单
2. 输入题目ID（如：1）
3. 编写代码
4. 选择语言
5. 提交代码
6. 等待评测结果

---

## 🎯 完整的功能导航

| 菜单项 | 路由 | 功能 | 是否需要登录 |
|--------|------|------|-------------|
| **题库** | `/problems` | 浏览所有题目 | ❌ |
| **代码评测** | `/judge` | 直接评测代码 | ❌ |
| **提交历史** | `/submissions` | 查看我的提交 | ✅ |
| **排行榜** | `/ranking` | 查看用户排名 | ❌ |

---

## 📊 页面关系图

```
登录页 (/login)
    ↓ 登录成功
    ↓
首页重定向 (/)
    ↓
    ├─→ 题库 (/problems)
    │       ↓ 点击题目
    │       ↓
    │   题目详情 (/problem/:id)
    │       ↓ 提交代码
    │       ↓
    │   评测结果
    │
    ├─→ 代码评测 (/judge)
    │       ↓ 直接提交
    │       ↓
    │   评测结果
    │
    ├─→ 提交历史 (/submissions) [需要登录]
    │       ↓
    │   查看提交详情
    │
    └─→ 排行榜 (/ranking)
```

---

## 🔍 调试提示

### 1. 题目列表仍然不显示

**检查浏览器控制台**：
```javascript
// 打开F12，在Console中查看
// 1. 检查API响应
// 2. 查看是否有错误信息
```

**检查Network标签**：
- 请求路径：`/api/problem/list?pageNum=1&pageSize=10`
- 响应状态：应该是 200
- 响应数据：应该包含 `data.list` 数组

### 2. 后端API检查

确认后端服务运行正常：
```powershell
# problem-service 应该在 8082 端口
curl http://localhost:8082/problem/list?pageNum=1&pageSize=10
```

### 3. Vite代理配置

检查 `frontend/vite.config.ts` 中的代理配置：
```typescript
proxy: {
  '/api': {
    target: 'http://localhost:8080', // gateway端口
    changeOrigin: true,
  }
}
```

---

## ✅ 验证成功的标志

### 题目列表
- ✅ 页面显示题目表格
- ✅ 分页器显示总数
- ✅ 可以点击题目跳转
- ✅ 搜索功能正常
- ✅ 难度筛选正常

### 代码评测
- ✅ 导航栏有"代码评测"选项
- ✅ 页面显示Monaco编辑器
- ✅ 可以输入代码
- ✅ 可以提交并获得结果

### 浏览器控制台
- ✅ 没有404错误
- ✅ 没有undefined/null错误
- ✅ API响应正常

---

## 🆘 常见问题

### Q1: 题目列表API 404

**检查**：
- problem-service 是否启动（端口8082）
- gateway 是否启动（端口8080）
- Nacos 是否运行正常

### Q2: 代码评测页面空白

**检查**：
- `JudgePage.vue` 文件是否存在
- Monaco Editor是否加载成功
- 浏览器控制台是否有错误

### Q3: 路由跳转不工作

**检查**：
- Vue Router是否正确配置
- `router/index.ts` 导出是否正确
- `main.ts` 是否注册了router

---

## 📝 后续优化建议

1. **统一后端返回格式**
   - 建议修改后端，统一使用 `records` 而不是 `list`
   - 或者在前端封装统一的数据转换层

2. **题目详情页优化**
   - 集成代码评测功能
   - 用户可以直接在题目详情页提交代码
   - `/judge` 页面作为快速评测入口

3. **用户体验优化**
   - 题目列表添加已完成标记
   - 提交历史显示题目标题
   - 排行榜接入真实数据

---

现在刷新浏览器，题目列表应该能正常显示了！🎉
